<!DOCTYPE html>
<!-- saved from url=(0063)https://dl.dropboxusercontent.com/u/25337488/web/hobo/hobo.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=US-ASCII"><title>AKA: 187</title>
<style>
	body { 
		background-color:black;
	}
	canvas {
		background-color:black;
	}
	#display {
		margin-bottom: 25px;
		cursor: crosshair;
		margin-left:auto;
		margin-right: auto;
	}
</style>
</head><body>
<center>
<div id="display">
<canvas id="gameCanvas" width="1280" height="800"></canvas>
</div>
</center>
<script src="./scripts/utils.js"></script>
<script src="./scripts/imageLoader.js"></script>
<script src="./scripts/box2d.js"></script>
<script src="./scripts/ship.js"></script>
<script src="./scripts/howler.js"></script>
<script>
console.log('start');
imageLoader.queueImage("car");
imageLoader.queueImage("car2");
imageLoader.queueImage("player");
imageLoader.queueImage("spritesheet");
imageLoader.queueImage("walksheet");
imageLoader.queueImage("title");
imageLoader.queueImage("title2");
var shootSfx = new Howl({urls: ["audio/shoot.wav", "audio/shoot.wav"], volume: 0.1});
var car1Sfx = new Howl({urls: ["audio/car1.wav", "audio/car1.wav"], volume:0.1});
var car2Sfx = new Howl({urls: ["audio/car2.wav", "audio/car2.wav"], volume:0.1});

imageLoader.loadQueuedImages(initGame);

//console.log('done!');

var REFMULTI = 2; //1= 120hz 2 =60hz

var canvas = document.getElementById("gameCanvas");
var context = canvas.getContext("2d");
var mouse = utils.captureMouse(canvas);

//box2d stuff
var SCALE = 30;
var SCALE2 = 15;

var world;
var b2Vec2 = Box2D.Common.Math.b2Vec2;
var b2BodyDef = Box2D.Dynamics.b2BodyDef;
var b2Body = Box2D.Dynamics.b2Body;
var b2FixtureDef = Box2D.Dynamics.b2FixtureDef;
var b2Fixture = Box2D.Dynamics.b2Fixture;
var b2World = Box2D.Dynamics.b2World;
var b2MassData = Box2D.Collision.Shapes.b2MassData;
var b2PolygonShape = Box2D.Collision.Shapes.b2PolygonShape;
var b2CircleShape = Box2D.Collision.Shapes.b2CircleShape;
var b2DebugDraw = Box2D.Dynamics.b2DebugDraw;
var b2AABB = Box2D.Collision.b2AABB;
var b2WorldManifold = Box2D.Collision.b2WorldManifold;
var b2ManifoldPoint = Box2D.Collision.b2ManifoldPoint;
var b2RayCastInput = Box2D.Collision.b2RayCastInput;
var b2RayCastOutput = Box2D.Collision.b2RayCastOutput;
var b2Listener = Box2D.Dynamics.b2ContactListener;

world = new b2World(new b2Vec2(0,0), true);

var Player = new Hobo(1408,1408);
Player.canFire = true;
//var Car = new Hobo(1000,1664);

var Agents = [];
var Pickups = [];
var Buildings = [];
var Roads = [];
var Intersections = [];
var chars = [];
var cars = [];

var state = 1;

window.addEventListener("keydown", function(e) {
	if(chars.indexOf(e.keyCode) == -1) {
		chars.push(e.keyCode);
		//console.log(chars.toString());
	}
}, false);
window.addEventListener("keyup", function(e) {
	var index = chars.indexOf(e.keyCode);
	chars.splice(index, 1);
}, false);
/*window.addEventListener("keyup", onKeyUp, false);
window.addEventListener("keydown", onKeyDown, false);
window.addEventListener("mousedown", onMouseDown, false);
window.addEventListener("mouseup", onMouseUp, false);
*/
gameCanvas.oncontextmenu = function() {
   //alert('right click');   
   //onRightClick();
   return false;
}	
var mapWidth = 2560;
var mapHeight = 2560;

var gameState = 0;

var cols = 52;
var rows = 34;
var tileSize = 256;
//1 = building, 2 = vert, 3 = horiz, 4 = inters
/*var map = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,7,3,3,3,12,3,3,3,3,3,12,3,3,3,3,12,3,3,3,3,3,12,3,3,3,3,12,3,3,3,3,8,1,1,1,1,7,3,3,12,3,3,12,3,3,8,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,3,3,6,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,3,3,6,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,11,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,3,3,11,3,3,3,3,6,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,11,3,3,3,11,3,3,3,3,3,11,3,3,3,3,10,12,3,3,3,3,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,11,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,7,3,3,3,3,3,3,3,11,3,3,3,3,11,3,3,3,3,11,3,3,3,3,11,3,3,3,3,11,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,6,3,12,3,10,3,12,3,5,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,10,3,3,6,1,1,2,1,1,1,
1,1,1,1,1,11,3,3,3,9,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,11,3,3,3,12,3,3,3,12,3,10,3,3,3,3,11,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,6,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,1,1,1,11,3,3,3,3,6,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,6,8,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,11,3,3,3,11,3,3,3,6,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,11,3,3,3,3,11,3,3,3,3,11,3,3,3,3,3,6,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,7,3,10,12,3,3,12,3,11,3,3,3,3,6,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,6,1,1,1,
1,1,1,7,3,10,3,3,12,10,3,12,3,10,3,3,6,1,1,2,1,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,6,8,1,1,1,2,1,1,6,8,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,3,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,11,3,11,3,10,3,3,3,3,11,3,3,12,3,10,3,3,3,3,6,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,11,3,3,12,3,10,12,3,3,10,12,3,3,11,3,3,3,6,1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,11,3,3,3,3,3,6,1,1,2,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,6,3,6,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,1,1,11,3,3,3,3,3,3,6,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,2,1,1,11,3,3,3,11,3,3,3,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,6,3,3,8,1,1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,6,3,3,10,3,3,10,3,3,3,5,1,1,1,1,1,6,3,3,10,3,3,3,3,3,3,10,3,3,10,3,3,3,3,3,3,10,3,3,3,3,3,10,3,3,5,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];*/


var map = [27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,33,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,34,27,27,27,
27,27,27,29,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,31,27,27,27,
27,27,27,29,36,4,10,10,10,10,9,10,10,10,10,9,10,10,10,10,9,10,10,10,10,9,10,10,10,10,9,10,10,10,10,10,9,10,10,10,9,10,10,10,10,10,5,36,31,27,27,27,
27,27,27,29,36,11,19,23,23,20,11,19,23,23,20,11,19,23,23,20,11,19,23,23,20,11,19,23,23,20,11,19,20,36,19,20,11,19,23,20,11,19,23,23,23,20,11,36,31,27,27,27,
27,27,27,29,36,11,26,18,18,24,11,26,18,18,24,11,26,18,18,24,11,26,18,18,24,11,26,18,18,24,11,22,21,36,22,21,11,26,18,24,11,26,18,18,18,24,11,36,31,27,27,27,
27,27,27,29,36,11,26,18,18,24,11,22,25,25,21,11,26,18,18,24,11,26,18,18,24,11,26,18,18,24,11,36,36,36,36,36,8,10,10,10,6,26,18,18,18,24,11,36,31,27,27,27,
27,27,27,29,36,11,26,18,18,24,8,10,10,10,10,6,26,18,18,24,11,22,25,25,21,11,22,25,25,21,11,19,20,36,19,20,11,26,18,24,11,22,25,25,25,21,11,36,31,27,27,27,
27,27,27,29,36,11,22,25,25,21,11,15,16,16,13,11,22,25,25,21,8,9,10,10,10,1,10,10,10,10,6,22,21,36,22,21,11,22,25,21,8,10,10,10,10,10,6,36,31,27,27,27,
27,27,27,29,36,8,10,10,10,10,1,10,10,10,10,7,10,9,10,10,7,6,15,16,13,11,19,23,23,20,8,10,10,10,10,10,1,10,10,10,6,19,23,23,23,20,11,36,31,27,27,27,
27,27,27,29,36,11,19,23,23,20,11,19,23,23,23,23,20,11,19,23,20,3,5,15,13,11,22,18,18,24,11,19,23,23,23,20,11,12,12,12,11,22,25,25,25,21,11,36,31,27,27,27,
27,27,27,29,36,11,26,18,18,24,11,26,18,25,25,18,24,11,26,18,24,12,11,12,12,11,36,26,18,24,11,22,25,25,25,21,11,14,14,14,8,10,10,10,9,10,6,36,31,27,27,27,
27,27,27,29,36,11,22,18,18,24,11,22,21,36,36,22,21,11,26,18,24,17,11,17,17,11,36,22,25,24,8,10,10,10,10,10,1,10,10,9,2,36,19,20,11,12,11,36,31,27,27,27,
27,27,27,29,36,11,36,26,18,24,8,10,10,10,10,10,10,6,22,25,21,14,11,14,14,11,36,36,36,14,11,19,23,23,23,20,11,12,12,11,36,19,18,24,11,17,11,36,31,27,27,27,
27,27,27,29,36,11,36,22,25,21,11,19,23,23,23,23,20,8,10,10,10,10,1,10,10,1,10,10,10,10,6,22,25,25,25,21,11,14,14,11,19,18,18,24,11,17,11,36,31,27,27,27,
27,27,27,29,36,8,10,10,10,10,6,26,18,18,18,18,24,11,19,23,23,20,11,27,27,11,19,23,23,20,8,10,10,10,9,10,7,10,10,6,22,25,25,21,11,14,11,36,31,27,27,27,
27,27,27,29,36,11,15,16,16,13,11,22,25,25,25,25,21,11,22,25,25,21,11,27,27,11,22,25,25,21,11,19,23,20,11,19,23,23,20,8,10,10,9,10,1,10,6,36,31,27,27,27,
27,27,27,29,36,8,10,10,10,10,1,10,10,10,10,9,10,7,10,10,10,10,1,10,10,1,10,10,10,10,6,26,18,24,11,26,18,18,24,11,19,20,11,12,11,12,11,36,31,27,27,27,
27,27,27,29,36,11,19,23,23,20,11,19,23,23,20,11,15,16,16,16,16,13,11,15,13,11,15,16,16,13,11,26,18,24,11,26,18,18,24,11,22,21,11,14,11,17,11,36,31,27,27,27,
27,27,27,29,36,11,26,18,18,24,11,26,18,18,24,11,19,23,20,4,10,10,7,10,10,7,5,19,23,20,11,22,25,21,11,22,25,25,21,8,10,10,1,10,6,17,11,36,31,27,27,27,
27,27,27,29,36,11,26,18,18,24,11,26,18,18,24,11,26,18,24,11,19,23,23,23,23,20,11,26,18,24,8,10,10,10,7,10,9,10,10,6,19,20,11,12,11,17,11,36,31,27,27,27,
27,27,27,29,36,11,22,25,25,21,11,22,25,25,21,11,26,18,24,11,26,18,18,18,18,24,11,26,18,24,11,19,23,23,23,20,11,19,20,11,22,21,11,14,11,14,11,36,31,27,27,27,
27,27,27,29,36,8,10,10,10,10,1,10,10,10,10,6,26,18,24,11,22,25,25,25,25,21,11,22,25,21,11,26,18,18,18,24,11,26,24,8,10,10,7,10,7,10,6,36,31,27,27,27,
27,27,27,29,36,11,19,23,23,20,11,19,23,23,20,11,22,25,21,8,10,10,10,10,10,10,1,10,10,10,6,22,25,25,25,21,11,22,21,11,19,23,23,23,23,20,11,36,31,27,27,27,
27,27,27,29,36,11,15,16,16,13,11,26,18,18,24,8,10,10,10,6,19,23,23,23,23,20,11,19,23,20,8,10,10,10,10,10,7,10,10,6,15,16,16,16,16,13,11,36,31,27,27,27,
27,27,27,29,36,11,22,25,25,21,11,22,25,25,21,11,15,16,13,11,22,25,25,25,25,21,11,22,25,21,11,15,16,16,16,16,16,16,13,11,22,25,25,25,25,21,11,36,31,27,27,27,
27,27,27,29,36,3,10,10,10,10,7,10,10,10,10,7,10,10,10,7,10,10,10,10,10,10,7,10,10,10,7,10,10,10,10,10,10,10,10,7,10,10,10,10,10,10,2,36,31,27,27,27,
27,27,27,29,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,31,27,27,27,
27,27,27,32,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,35,27,27,27,
27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,
27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27];





var colMap = [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,7,3,3,3,12,3,3,3,3,3,12,3,3,3,3,12,3,3,3,3,3,12,3,3,3,3,12,3,3,3,3,8,1,1,1,1,7,3,3,12,3,3,12,3,3,8,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,3,3,6,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,3,3,6,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,11,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,3,3,11,3,3,3,3,6,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,11,3,3,3,11,3,3,3,3,3,11,3,3,3,3,10,12,3,3,3,3,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,11,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,2,1,1,1,7,3,3,3,3,3,3,3,11,3,3,3,3,11,3,3,3,3,11,3,3,3,3,11,3,3,3,3,11,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,6,3,12,3,10,3,12,3,5,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,10,3,3,6,1,1,2,1,1,1,
1,1,1,1,1,11,3,3,3,9,1,1,1,1,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,11,3,3,3,12,3,3,3,12,3,10,3,3,3,3,11,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,6,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,1,1,1,11,3,3,3,3,6,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,6,8,1,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,1,1,11,3,3,3,11,3,3,3,6,1,1,1,1,2,1,1,1,1,1,2,1,1,1,1,11,3,3,3,3,11,3,3,3,3,11,3,3,3,3,3,6,1,1,2,1,1,1,
1,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,7,3,10,12,3,3,12,3,11,3,3,3,3,6,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,11,3,3,6,1,1,1,
1,1,1,7,3,10,3,3,12,10,3,12,3,10,3,3,6,1,1,2,1,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,2,1,1,1,1,2,1,1,2,1,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,6,8,1,1,1,2,1,1,6,8,1,2,1,2,1,1,1,1,2,1,1,1,1,2,1,1,1,1,11,3,3,3,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,1,1,2,1,1,1,2,1,1,1,2,1,1,1,11,3,11,3,10,3,3,3,3,11,3,3,12,3,10,3,3,3,3,6,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,11,3,3,12,3,10,12,3,3,10,12,3,3,11,3,3,3,6,1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,11,3,3,3,3,3,6,1,1,2,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,6,3,6,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,1,1,11,3,3,3,3,3,3,6,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,2,1,1,1,1,1,2,1,1,1,1,1,1,2,1,1,2,1,1,11,3,3,3,11,3,3,3,3,3,11,3,3,6,1,1,1,
1,1,1,2,1,1,2,1,1,2,1,1,1,2,1,1,6,3,3,8,1,1,2,1,1,1,1,1,1,2,1,1,2,1,1,1,1,1,1,2,1,1,1,1,1,2,1,1,2,1,1,1,
1,1,1,6,3,3,10,3,3,10,3,3,3,5,1,1,1,1,1,6,3,3,10,3,3,3,3,3,3,10,3,3,10,3,3,3,3,3,3,10,3,3,3,3,3,10,3,3,5,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,
1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];

function SteeringForce() {
	this.x = 0;
	this.y = 0;
}



//******************
//*	    ACTORS     *
//******************

//the Hobo, our loveable little playable character who must collect change to live.
function Hobo(x, y) {
	this.x = x;
	this.y = y;
	this.height = 15;
	this.width = 15;
	this.orientation = 0;
	this.wallet = 0;
	this.moneyCollected = 0;
	this.crackSmoked = 0;
	this.slowAmount = 0;
	this.smokedCrack = false;	
	
	this.count1 = 0;
	this.maxCount = 2500
	this.count2 = this.maxCount;
	this.count3 = 1700;
	//begin initialization of BOX2D object
	
	this.fixDef = new b2FixtureDef;
	this.fixDef.density = 5.0;
	this.fixDef.friction = 1;
	this.fixDef.restitution = 0.00;
	this.bodyDef = new b2BodyDef;
	this.bodyDef.type = b2Body.b2_dynamicBody;
	this.bodyDef.position.x = this.x / SCALE;
	this.bodyDef.position.y = this.y / SCALE;
	this.bodyDef.linearDamping = 1.0;
	this.fixDef.shape = new b2CircleShape(0.5);
	this.Body = world.CreateBody(this.bodyDef);
	this.Body.CreateFixture(this.fixDef);
	
	
	///
	
	
		/*this.fixDef = new b2FixtureDef;
		this.fixDef.density = 5.0;
		this.fixDef.friction = 1;
		this.fixDef.restitution = 0;
		this.bodyDef = new b2BodyDef;
		this.bodyDef.type = b2Body.b2_dynamicBody;
		this.bodyDef.position.x = this.x / SCALE;
		this.bodyDef.position.y = this.y / SCALE;
		this.bodyDef.linearDamping = 1.0;
		this.fixDef.shape = new b2PolygonShape();
		//this.fixDef.shape.SetAsBox(this.width/2/SCALE, this.height/2/SCALE);
		this.fixDef.shape.SetAsBox(this.width/SCALE,this.height/SCALE);
		this.Body = world.CreateBody(this.bodyDef);
		this.Body.CreateFixture(this.fixDef);*/
	
	
	
}

var PosX = Player.x;
var PosY = Player.y;
var oldPosX = Player.x;
var oldPosY = Player.y;
var newPosX = Player.x;
var newPosY = Player.y;
	
Hobo.prototype.draw = function() {
	//draw hobo
	
	context.save();
	
	context.translate(canvas.width/2, canvas.height/2);
	context.rotate(this.orientation + (Math.PI/2));
	
	/*context.lineWidth="4";
	context.strokeStyle="red";
	context.rect(-this.width/2,-this.height/2,this.width, this.height);
	context.stroke();
	context.rect(-this.width/2,-this.height/2, 5, 10);
	context.stroke();
	*/
	//console.log(this.x);
	
	/*context.beginPath();
	context.fillStyle = "red"
	context.arc(0,0, 15, 0, 2 * Math.PI);
	context.fill();
	context.closePath()
	context.beginPath()
	context.fillStyle = "black"
	context.moveTo(1,0);
	context.lineTo(1,16);
	context.lineTo(-1,16);
	context.lineTo(-1,0);
	context.closePath();
	context.fill();*/
	
	if (state == 1) {
		//var img=document.getElementById("car");
		//context.drawImage(img,-16,-32);
		context.drawImage(imageLoader.images["car2"],-16,-32);
	} else {
		//var img=document.getElementById("player");
		//context.drawImage(imageLoader.images["player"],-16,-16);
		//context.drawImage(imageLoader.images["walksheet"], currentFrame * frameWidth, 0, frameWidth, frameHeight, 0, 0, frameWidth, frameHeight);
		
		var vel = Player.Body.GetLinearVelocity();
		
		//var speed = vel.Normalize();
		
		//console.log(vel);
		//var velCurrent = (vel.x * vel.y)+.5;
		/*
		if (speed >= .75) {
			context.drawImage(imageLoader.images["walksheet"], 0, currentFrame * frameHeight, frameWidth, frameHeight, -16, -16, frameWidth, frameHeight);
		} else if (speed <= -.75) {
			context.drawImage(imageLoader.images["walksheet"], 0, currentFrame * frameHeight, frameWidth, frameHeight, -16, -16, frameWidth, frameHeight);
		}else {
			context.drawImage(imageLoader.images["player"],-16,-16);
		}*/
		
		
		
		
		PosX = Player.x;
		PosY = Player.y;
		
		oldPosX = Player.x;
		oldPosY = Player.y;
		//var newPosX = Player.x;
		//var newPosY = Player.y;
		
		var dx = newPosX - oldPosX,
			dy = newPosY - oldPosY,
			dist = Math.sqrt(dx * dx + dy * dy);
			
		if (dist >= .5) {
			context.drawImage(imageLoader.images["walksheet"], 0, currentFrame * frameHeight, frameWidth, frameHeight, -16, -16, frameWidth, frameHeight);
		} else {
			context.drawImage(imageLoader.images["player"],-16,-16);
		}
		
		
		/*
		if ((oldPosX - newPosX) >=.5 || (oldPosY - newPosY) >=.5) {
			context.drawImage(imageLoader.images["walksheet"], 0, currentFrame * frameHeight, frameWidth, frameHeight, -16, -16, frameWidth, frameHeight);
		} else if ((oldPosX - newPosX) >=.5 || (oldPosY - newPosY) >=.5) {
			context.drawImage(imageLoader.images["walksheet"], 0, currentFrame * frameHeight, frameWidth, frameHeight, -16, -16, frameWidth, frameHeight);
		} else {
			context.drawImage(imageLoader.images["player"],-16,-16);
		}*/
			
		//context.drawImage(imageLoader.images["walksheet"], 0, currentFrame * frameHeight, frameWidth, frameHeight, -16, -16, frameWidth, frameHeight);
		
		newPosX = Player.x;
		newPosY = Player.y;
		
		
	}
	
	
	context.restore();

}

Hobo.prototype.update = function(name) {
	if (state == 1) {	
		
		//keyboard input for our hobo
		force = new b2Vec2(0,0);
		if(chars.length === 1 ) { //if one key is pressed
			
			if (chars[0] == 87) { //W
				force.x = 0;
				force.y = -1;
				//car1Sfx.play();
			}
			else if (chars[0] == 65) { //A
				force.x = -1;
				force.y = 0;
				
			}
			else if (chars[0] == 83) { //S
				force.x = 0;
				force.y = 1;
			}
			else if (chars[0] == 68) { //D
				force.x = 1;
				force.y = 0;
			}
			/*else if (chars[0] == 69) { //E
				if (state == 1) {
					state = 0;
				} else if (state == 0) {
					state = 1;
				}
			}*/

		}
		else if(chars.length >= 2) { //if two keys are pressed
			if (chars.indexOf(87) > -1 && chars.indexOf(68) > -1) { //W+D
				force.x = 1;//0.75;
				force.y = -1;//-0.75;
			}
			if (chars.indexOf(83) > -1 && chars.indexOf(68) > -1) { //D+S
				force.x = 1;//0.75;
				force.y = 1;//0.75;
			}
			if (chars.indexOf(83) > -1 && chars.indexOf(65) > -1) { //S+A
				force.x = -1;//-0.75;
				force.y = 1;//0.75;
			}
			if (chars.indexOf(87) > -1 && chars.indexOf(65) > -1) { //W+A
				force.x = -1;//-0.75;
				force.y = -1;//-0.75;
			}
			/*if (chars.indexOf(32) > -1)
			{
				if(this.smokedCrack == false && this.wallet >= 200 && utils.getDistance(this.x, this.y, theDealer.x, theDealer.y) < 150){
					this.smokedCrack = true;
					this.crackSmoked++;
					this.count1 = 0;
					this.count2 = this.maxCount;
					this.count3 = 1700;
				}
			}*/
		}
		
		
		force.x = force.x*REFMULTI;
		force.y = force.y*REFMULTI;
		this.Body.ApplyImpulse(force, this.Body.GetWorldCenter());
		//enforce max velocity
		var vel = this.Body.GetLinearVelocity();
		this.orientation = Math.atan2(vel.y,vel.x);
		//console.log(vel.y);
		//var speed = vel.Normalize();
		//this.Body.ApplyForce((0.05 * -vel), this.Body.GetWorldCenter());
		//console.log(speed);
		//console.log(vel.x);
		//console.log(vel.y);
		//update where our hobo is on screen
		var thevec = this.Body.GetPosition();
		this.x = thevec.x * SCALE;
		this.y = thevec.y * SCALE;
		
		//car1Sfx.play();
		
		
		if (vel.x >= 25) {
			vel.x = 25;
		}
		if (vel.x <= -25) {
			vel.x = -25;
		}
		if (vel.y >= 25) {
			vel.y = 25;
		}
		if (vel.y <= -25) {
			vel.y = -25;
		}
	} else {
		
		//keyboard input for our hobo
		force = new b2Vec2(0,0);
		if(chars.length === 1 ) { //if one key is pressed
			
			if (chars[0] == 87) { //W
				force.x = 0;
				force.y = -1;
			}
			else if (chars[0] == 65) { //A
				force.x = -1;
				force.y = 0;
			}
			else if (chars[0] == 83) { //S
				force.x = 0;
				force.y = 1;
			}
			else if (chars[0] == 68) { //D
				force.x = 1;
				force.y = 0;
			}
		}
		else if(chars.length >= 2) { //if two keys are pressed
			if (chars.indexOf(87) > -1 && chars.indexOf(68) > -1) { //W+D
				force.x = 0.5;
				force.y = -0.5;
			}
			if (chars.indexOf(83) > -1 && chars.indexOf(68) > -1) { //D+S
				force.x = 0.5;
				force.y = 0.5;
			}
			if (chars.indexOf(83) > -1 && chars.indexOf(65) > -1) { //S+A
				force.x = -0.5;
				force.y = 0.5;
			}
			if (chars.indexOf(87) > -1 && chars.indexOf(65) > -1) { //W+A
				force.x = -0.5;
				force.y = -0.5;
			}
		}
		
		
		force.x = force.x*REFMULTI;
		force.y = force.y*REFMULTI;
		
		this.Body.ApplyImpulse(force, this.Body.GetWorldCenter());
		//enforce max velocity
		var vel = this.Body.GetLinearVelocity();
		this.orientation = Math.atan2(vel.y,vel.x);
		//var speed = vel.Normalize();
		//this.Body.ApplyForce((0.05 * -vel), this.Body.GetWorldCenter());
		//console.log(speed);
		//console.log(vel.x);
		//console.log(vel.y);
		//update where our hobo is on screen
		
		var thevec = this.Body.GetPosition();
		this.x = thevec.x * SCALE;
		this.y = thevec.y * SCALE;
		

		
		
		if (vel.x >= 7) {
			vel.x = 7;
		}
		if (vel.x <= -7) {
			vel.x = -7;
		}
		if (vel.y >= 7) {
			vel.y = 7;
		}
		if (vel.y <= -7) {
			vel.y = -7;
		}
	}
}

function onKeyDown(e) {
	switch(e.keyCode) {
		case 69: // E

			break;
		case 37:      //left


          break;
        case 39:      //right

          break;
        case 38:      //up

          break;
		case 40:      //Down


          break;
		case 13:      //Enter


          break;
		case 32:      //Space


          break;		  
	};
}
function onKeyUp(e) {
	switch(e.keyCode) {
		case 69: // E
			if (state == 1) {
				state = 0;
			} else if (state == 0) {
				state = 1;
			}
			break;
		case 37:      //left

          break;
        case 39:      //right

          break;
        case 38:      //up

          break;
		case 40:      //Down

          break;	
		case 13:      //Enter
			//gameState = 1;
			//console.log('enter');
			if (gameState == 0) {
				gameState = 1;
			}

          break;
		case 32:      //Space
			
          break;			  
	};
}

function onMouseDown(e) {
	//shootSfx.play();
	Player.isFiring = true;
	//ship.isFiring = true;
}
function onMouseUp(e) {
	Player.isFiring = false;
	//ship.isFiring = false;
}
//******************
//*	   OBJECTS     *
//******************

drawn = false;
built = false;
//1 = building, 2 = vert, 3 = horiz, 4 = inters
function drawMap(){
	
	if (!built) {
		for (var ii = 0; ii < rows; ii++){
			for(var kk = 0; kk < cols; kk++){
				var indexLoc = kk + ii*cols;
				
				if (map[indexLoc] == 1){
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,1));
					built = true;
				}	else if (map[indexLoc] == 2) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,2));
				}	else if (map[indexLoc] == 3) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,3));
				}	else if (map[indexLoc] == 4) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,4));
				}	else if (map[indexLoc] == 5) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,5));
				}	else if (map[indexLoc] == 6) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,6));
				}	else if (map[indexLoc] == 7) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,7));
				}	else if (map[indexLoc] == 8) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,8));
				}	else if (map[indexLoc] == 9) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,9));
				}	else if (map[indexLoc] == 10) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,10));
				}	else if (map[indexLoc] == 11) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,11));
				}	else if (map[indexLoc] == 12) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,12));
				}	else if (map[indexLoc] == 13) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,13));
				}	else if (map[indexLoc] == 14) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,14));
				}	else if (map[indexLoc] == 15) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,15));
				}	else if (map[indexLoc] == 16) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,16));
				}	else if (map[indexLoc] == 17) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,17));
				}	else if (map[indexLoc] == 18) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,18));
				}	else if (map[indexLoc] == 19) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,19));
				}	else if (map[indexLoc] == 20) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,20));
				}	else if (map[indexLoc] == 21) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,21));
				}	else if (map[indexLoc] == 22) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,22));
				}	else if (map[indexLoc] == 23) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,23));
				}	else if (map[indexLoc] == 24) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,24));
				}	else if (map[indexLoc] == 25) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,25));
				}	else if (map[indexLoc] == 26) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,26));	
				}	else if (map[indexLoc] == 27) {
					Buildings.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,27));
				}	else if (map[indexLoc] == 28) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,28));
				}	else if (map[indexLoc] == 29) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,29));
				}	else if (map[indexLoc] == 30) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,30));
				}	else if (map[indexLoc] == 31) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,31));
				}	else if (map[indexLoc] == 32) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,32));
				}	else if (map[indexLoc] == 33) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,33));
				}	else if (map[indexLoc] == 34) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,34));
				}	else if (map[indexLoc] == 35) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,35));
				}	else if (map[indexLoc] == 36) {
					Roads.push(new mapObject(kk*tileSize,ii*tileSize,tileSize,tileSize,36));
				}
			}
		}
	}
}

function mapObject(x, y, h, w, t) {
	this.x = x;
	this.y = y;
	this.height = h;
	this.width = w;
	this.type = t;
	/* 
	type 
		1 = building
		2 = road
		3 = intersecton
	*/
	if(this.type >= 12) {
		if(this.type <= 27) {
		//set up BOX2D object
		this.fixDef = new b2FixtureDef;
		this.fixDef.density = 5.0;
		this.fixDef.friction = 0.5;
		this.fixDef.restitution = .00;
		this.bodyDef = new b2BodyDef;
		this.bodyDef.type = b2Body.b2_staticBody;
		this.bodyDef.position.x = Math.floor((this.x + (this.width/2)) / SCALE);
		this.bodyDef.position.y = Math.floor((this.y + (this.height/2)) / SCALE);
		this.fixDef.shape = new b2PolygonShape();
		this.fixDef.shape.SetAsBox(this.width/2/SCALE, this.height/2/SCALE);
		this.Body = world.CreateBody(this.bodyDef);
		this.Body.CreateFixture(this.fixDef);
		}
	}
	
}

doneDraw = false;
mapObject.prototype.draw = function(ox,oy) {
	if(this.type == 1) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 0*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();
	}	else if(this.type == 2) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 1*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 3) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 2*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 4) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 3*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 5) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 4*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 6) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 5*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 7) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 6*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 8) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 7*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 9) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 8*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 10) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 9*tileSize, 0*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 11) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 0*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 12) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 1*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 13) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 2*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 14) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 3*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 15) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 4*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 16) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 5*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 17) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 6*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 18) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 7*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 19) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 8*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 20) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 9*tileSize, 1*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 21) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 0*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 22) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 1*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 23) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 2*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 24) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 3*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 25) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 4*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 26) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 5*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 27) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		//context.translate(this.x-ox+canvas.width/2, this.y-oy+canvas.height/2);
		context.drawImage(imageLoader.images["spritesheet"], 6*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 28) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 7*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 29) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 8*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 30) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 9*tileSize, 2*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 31) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 0*tileSize, 3*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 32) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 1*tileSize, 3*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 33) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 2*tileSize, 3*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 34) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 3*tileSize, 3*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 35) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 4*tileSize, 3*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}	else if(this.type == 36) {
		context.save();
		context.translate(Math.floor(this.x-ox+canvas.width/2), Math.floor(this.y-oy+canvas.height/2));
		context.drawImage(imageLoader.images["spritesheet"], 5*tileSize, 3*tileSize, tileSize, tileSize, this.width-tileSize, this.height-tileSize, this.width, this.height);
		context.restore();	
	}
}

mapObject.prototype.update = function() {
		//drawn;

}
function drawCircle(x, y, radius) {
	context.save();
	context.strokeStyle = "red";
	context.beginPath();
	context.arc(x, y, radius, 0, 2 * Math.PI);
	context.stroke();
	context.restore();
}
//AGENT
function Agent() {
	this.x = canvas.width/2;
	this.y = canvas.height/2;
	this.orientation = 0;
	this.rotation = 0;
	this.alpha = .5;
	this.scale = 1;
	
	this.vx = 0;
	this.vy = 0;
		
	this.maxSpeed = 1;
	this.maxAcceleration = 1.25;
	
	this.radius = 25;
	//Bullet Draw
	this.drawBul = function() {
		context.save();

		//context.translate(canvas.width/2, canvas.height/2);
		context.translate(this.x, this.y);
		context.rotate(this.orientation);
		
		context.lineWidth = 2;
		context.strokeStyle = "yellow";
		//context.fillStyle = "red";
		context.beginPath();
		//context.arc(0, 0, 10, 0, 2*Math.PI);
		context.moveTo(-5,5);
		context.lineTo(-5,-5);
		context.lineTo(5,-5);
		context.lineTo(5,5);
		context.lineTo(-5,5);
		context.lineTo(5,5);
		context.moveTo(5,-5);
		context.lineTo(-5,5);
		//context.lineTo(0,0);
		//context.closePath();
		
		//context.fill();
		context.stroke();
		context.restore();
	}
}

//BULLET FUNCTION
function updateBullets() {
	
	var dx = mouse.x - canvas.width/2;//Player.x;
	var dy = mouse.y - canvas.height/2;//Player.y;
	
	//this.orientation = Math.atan2(dy, dx);
	
	mouseOrientation =  Math.atan2(dy,dx);
	
	
	bullRot = mouseOrientation;//Player.orientation;
	
	if (Player.isFiring && Player.canFire) {
		var bullet = new Agent();
		bullet.x = canvas.width/2;//Player.x;
		bullet.y = canvas.height/2;//Player.y;//-5;
		bullet.radius = 2;
		bullets.push(bullet);
		bullRots.push(bullRot);
		//console.log(bullets.length);
		shootSfx.play();
		Player.canFire = false;
		//attachBulletPfx(bullet);
		window.setTimeout(function() { Player.canFire = true; }, bulletFireDelayMs);
		//ship.canFire = false;
		//setTimeout(function(){ship.canFire = true},500);
	}
	
	for (var i = bullets.length - 1; i >= 0; --i) {
		for (var i = bullRots.length - 1; i >= 0; --i) {	
			var blt = bullets[i];
			var bltRot = bullRots[i];
			//bullRot = agent.orientation;
			//bullRots.push(bullRot);	
			
			//CORRECT(?) Movement
			blt.x += Math.cos(bltRot)*bullSpeed;
			blt.y += Math.sin(bltRot)*bullSpeed;
			
			//blt.x = canvas.width/2;
			//blt.y = canvas.height/2;
			
			//this.rotation = ship.orientation;
			
			//Correct rotation
			blt.orientation += .51;
			
			//bullets[i].orientation = ship.orientation;//utils.getMagnitude(ship.vx, ship.vy);
			
			//screen wrapping
			/*if (blt.x >= canvas.width - blt.radius || blt.x <= blt.radius || blt.y >= canvas.height - blt.radius || blt.y <= blt.radius) {
				bullets.splice(i,1);
				bullRots.splice(i,1);
				//wallSfx.play();
			}	*/	
		}
	}
}

function drawBullets() {
	for (var i = 0; i < bullets.length; ++i) {
		for (var i = 0; i < bullRots.length; ++i) {
			bullets[i].drawBul();
			/*context.save();
			
			context.translate(bullRots[i].x, bullRots[i].y);
			context.rotate(bullets[i].orientation);
			
			context.lineWidth = 2;
			context.strokeStyle = "yellow";
			//context.fillStyle = "red";
			context.beginPath();
			//context.arc(0, 0, 10, 0, 2*Math.PI);
			context.moveTo(-5,5);
			context.lineTo(-5,-5);
			context.lineTo(5,-5);
			context.lineTo(5,5);
			context.lineTo(-5,5);
			context.lineTo(5,5);
			context.moveTo(5,-5);
			context.lineTo(-5,5);
			//context.lineTo(0,0);
			//context.closePath();
			
			//context.fill();
			context.stroke();
			context.restore();*/
			//console.log(Player.orientation);
		}
	}
}

//BULLETS
var bullets = [];
var bullRot = 0;
var bullRots = [];
var bullSpeed = 6;
var bulletFireDelayMs = 200;

//**********************
//* STEERING BEHAVIORS *
//**********************

function ease1(t, b, c, d) {//Ease in Quintic
	var ts=(t/=d)*t;
	var tc=ts*t;
	return b+c*(tc*ts);
}
function easeIQr(t) {//Easing In Quart
	return t*t*t*t;
}
function easeOQn(t) {//Easing Out Quint
	return 1+(--t)*t*t*t*t
}
function ease2(t, b, c, d) {
	var ts=(t/=d)*t;
	var tc=ts*t;
	return b+c*(1.5*tc*ts + -2*ts*ts + 3*tc + -2*ts + 0.5*t);
}
function seek(agent, targetX, targetY) {//move toward
	var x = targetX - agent.x;
	var y = targetY - agent.y;
	
	var distance = utils.getMagnitude(x, y);
	
	x = x / distance * agent.maxAcceleration;
	y = y / distance * agent.maxAcceleration;
	
	var result = new b2Vec2;
	result.x = x;
	result.y = y;
	return result;
	
}
function arrive(agent, targetX, targetY) {
	var result = new b2Vec2;
	//get direction from agent to target
	var directionX = targetX - agent.x;
	var directionY = targetY - agent.y;
	
	// normalize direction
	var distance = utils.getMagnitude(directionX, directionY);
	directionX = directionX / distance; 
	directionY = directionY / distance; 
	
	if (distance > 200) {
		targetSpeed = agent.maxAcceleration;
	}
	else {
		targetSpeed = agent.maxAcceleration * distance / 200;
	}
	var targetVelocityX = directionX * targetSpeed;
	var targetVelocityY = directionY * targetSpeed;

	// steer toward desired velocity
	result.x = (targetVelocityX - agent.Body.GetLinearVelocity.x);
	result.y = (targetVelocityY - agent.Body.GetLinearVelocity.y);
	
	return result;
}
function flee(agent, targetX, targetY) {// move away
	var x = agent.x - targetX;
	var y = agent.y - targetY;
	
	var distance = Math.sqrt(x * x + y * y);
	
	x = x / distance * agent.maxAcceleration;
	y = y / distance * agent.maxAcceleration;
	
	var result = new b2Vec2;
	result.x = x;
	result.y = y;
	return result;
}
function pursue(agent, targetX, targetY) {// move toward target future position
	var dx = targetX - agent.x;
	var dy = targetY - agent.y;
	
	var dist = Math.sqrt(dx * dx + dy *dy);
	
	//var t = dist / targetMaxS;
	var t = dist * 0.1;
	var vec = Player.Body.GetLinearVelocity();
	var targetNewX = vec.x * t + targetX;
	var targetNewY = vec.y * t + targetY;
	return seek(agent, targetNewX, targetNewY);
}
function evade(agent, targetX, targetY) {// evade away from future target position
	//var x = targetX - agent.x;
	var y = targetY - agent.y;
	
	var distance = Math.sqrt(x * x + y * y);
	
	x = x / distance * agent.maxAcceleration;
	y = y / distance * agent.maxAcceleration;
	
	steeringForce.linearX = x;
	steeringForce.linearY = y;
	
	var dx = targetX - agent.x;
	var dy = targetY - agent.y;
	
	var dist = Math.sqrt(dx * dx + dy *dy);
	
	var t = dist / targetMaxS;
	
	var targetNewX = targetVX * t + targetX;
	var targetNewY = targetVY * t + targetY;
	
	return flee(agent, targetNewX, targetNewY, steeringForce);
}	
function wander(agent, steeringForce) {
	// perturb wander angle by a small random amount.
	var deltaWander = Math.random() * agent.wanderRate;
	agent.wanderAngle += Math.random() > 0.5 ? deltaWander : -deltaWander;
			
	// move target to wanderOffset in front of agent
	var targetX = agent.x + Math.cos(agent.orientation) * agent.wanderOffset + Math.cos(agent.wanderAngle) * agent.wanderRadius;
	var targetY = agent.y + Math.sin(agent.orientation) * agent.wanderOffset + Math.sin(agent.wanderAngle) * agent.wanderRadius;
	
	// draw the wander circle, etc. if drawDebug is enabled.
	if (drawDebug == true) {
		drawCircle(agent.x + Math.cos(agent.orientation) * agent.wanderOffset, agent.y + Math.sin(agent.orientation) * agent.wanderOffset, agent.wanderRadius);
		drawCircle(targetX, targetY, 8);
		context.moveTo(agent.x, agent.y);
		context.lineTo(agent.x + Math.cos(agent.orientation) * agent.wanderOffset, agent.y + Math.sin(agent.orientation) * agent.wanderOffset);
		context.lineTo(targetX, targetY);
		context.stroke();
	}
	
	// seek toward the target point
	return seek(agent, targetX, targetY, steeringForce);
}
function separation(agent, neighbors) {
	for (var i = 0; i < neighbors.length; ++i) {
		var toAgentX = agent.x - neighbors[i].x;
		var toAgentY = agent.y - neighbors[i].y;
		var toAgentMagnitude = utils.getMagnitude(toAgentX, toAgentY);
		if (toAgentMagnitude > 0) {
			var normalizedToAgentX = toAgentX / toAgentMagnitude;
			var normalizedToAgentY = toAgentY / toAgentMagnitude;
			
			// scale force to inversely proportional to distance from neighbor:
			this.steeringForce.x += normalizedToAgentX / toAgentMagnitude;
			this.steeringForce.y += normalizedToAgentY / toAgentMagnitude;
		}
	}
}

//init();

//var spawner = new spawnController();
//spawner.initWorld();

var targetX = Player.x;
var targetY = Player.y;
var targetX2 = mouse.x;//waypoints[points].x;
var targetY2 = mouse.y;//waypoints[points].y; 
 
// image data
var frameWidth = 96;
var frameHeight = 32;

 // animation data
var startFrame = 0;
var endFrame = 2;
var currentFrame = startFrame;
var animationTimer = 0;
var frameTimeSeconds = 1 / 7; // i.e., 15 frames per second
var previousTime = Date.now();

var mouseOrientation = 0;
  
function initGame() {
	
	window.addEventListener("keydown", onKeyDown, false);
	window.addEventListener("keyup", onKeyUp, false);
	window.addEventListener("mousedown", onMouseDown, false);
	window.addEventListener("mouseup", onMouseUp, false);
	
	(function tick() {
		//context.clearRect(0, 0, canvas.width, canvas.height);
		window.requestAnimationFrame(tick);
		
		context.clearRect(0, 0, canvas.width, canvas.height);
		
		if(gameState == 0) {
			context.clearRect(0, 0, canvas.width, canvas.height);
			context.drawImage(imageLoader.images["title"],0,0);
			context.drawImage(imageLoader.images["title2"],0,0);
		}
		if(gameState == 1) {
			//console.log(gameState);
			context.clearRect(0, 0, canvas.width, canvas.height);
			world.Step((1/60),10,10);
			
			//ANIMATION TIMING
			var currentTime = Date.now();
	
			// divide by 1000 to convert millseconds to seconds....
			var elapsedTime = (currentTime - previousTime) / 1000;
			
			// limit elapsed time to one animation frame so that the
			// the animation does not run too fast when the window loses
			// then regains focus.
			if (elapsedTime > frameTimeSeconds) {
				elapsedTime = frameTimeSeconds;
			}
			
			animationTimer += elapsedTime;
			
			// flip to the next frame
			if (animationTimer >= frameTimeSeconds) {
				animationTimer -= frameTimeSeconds;
				
				currentFrame += 1;
				
				// if all frames have been displayed, go back to first frame.
				if (currentFrame > endFrame) {
					currentFrame = startFrame;
				}
			}
			
			previousTime = currentTime;
			//ANIMATION TIMING
			
			drawMap();
			
			for(var i = 0; i < Buildings.length; ++i) {
				//Buildings[i].update();
				Buildings[i].draw(Player.x,Player.y);
			}
			for(var i = 0; i < Roads.length; ++i) {
				//Roads[i].update();
				Roads[i].draw(Player.x,Player.y);
			}
			for(var i = 0; i < Intersections.length; ++i) {
				//Intersections[i].update();
				Intersections[i].draw(Player.x,Player.y);
			}
			for(var i = 0; i < Pickups.length; ++i) {
				//Pickups[i].update();
				Pickups[i].draw(Player.x,Player.y);
			}
			for(var i = 0; i < Agents.length; ++i) {
				var agent = Agents[i];
				//agent.update();
				agent.draw(Player.x, Player.y);
			}
			
			//Car.update();
			//Car.draw();
			//ship.draw();
			
			context.save();
			
			Player.update();
			Player.draw();
			
			//console.log(bullets.length);
			//console.log(targetX);
			
			drawCircle(mouse.x, mouse.y, 12);
			
			updateBullets();
			drawBullets();
			//console.log(thrust);
			//console.log(vx);
			//console.log(state);

			//requestAnimationFrame(tick);
		}
		if(gameState == 2) {
			context.save();
			context.fillStyle = "black";
			context.globalAlpha = 0.5;
			context.fillRect(0, 0, canvas.width, canvas.height)
			context.fillStyle = "red";
			context.globalAlpha = 1;
			context.font = "75px Verdana";
			context.fillText("GAME OVER",canvas.width/2 - 220, 200);
			context.font = "25px Verdana";
			var dollars = Math.floor(Player.moneyCollected/100)
			var cents = Math.round((Player.moneyCollected/100 - dollars) * 100)
			context.fillText("You picked up $" + dollars + "." + cents, canvas.width/2 - 140, 240);
			context.fillText("You smoked " + Player.crackSmoked + " crack hits",  canvas.width/2 - 140, 280)
			context.fillText("Press F5 to restart game", canvas.width/2 - 140, 320);
		}		
		if(gameState == 3) {
			context.save();
			context.fillStyle = "black";
			context.globalAlpha = 0.5;
			context.fillRect(0, 0, canvas.width, canvas.height)
			context.fillStyle = "red";
			context.globalAlpha = 1;
			context.font = "75px Verdana";
			context.fillText("GAME OVER",canvas.width/2 - 220, 200);
			context.font = "25px Verdana";
			var dollars = Math.floor(Player.moneyCollected/100)
			var cents = Math.round((Player.moneyCollected/100 - dollars) * 100)
			context.fillText("You picked up $" + dollars + "." + cents, canvas.width/2 - 140, 240);
			context.fillText("You smoked " + Player.crackSmoked + " crack hits",  canvas.width/2 - 140, 280)
			context.fillText("Press F5 to restart game", canvas.width/2 - 140, 320);
		}
		
	})();
}
</script></body></html>